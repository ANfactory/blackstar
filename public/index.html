<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <style>
        body, body * {
            padding: 0;
            margin: 0;
        }

        html, body {
            height: 100%;
        }

        svg {
            display: block;
            width: 100%;
            height: 100%;
        }
    </style>
</head>
<body>
<svg class="blackstar"></svg>

<script src="//cdnjs.cloudflare.com/ajax/libs/lodash.js/3.10.1/lodash.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/snap.svg/0.3.0/snap.svg-min.js"></script>
<script src="//code.jquery.com/jquery-1.12.0.min.js"></script>
<script>

    function Branch(index) {
        this.index = index;
        this.openState = false;
    }

    $.extend(Branch.prototype, {
        open: function () {
            this.openState = true;
        },
        close: function () {
            this.openState = false;
        },
        isOpen: function () {
            return this.openState;
        }
    });


    function createStar(branchNb) {
        var star = [];
        for (var i = 0; i < branchNb; i++) {
            star.push(new Branch(i));
        }
        return star
    }

    function calculateStarPoints(centerX, centerY, branchs, radius) {
        var results = [];
        var angle = Math.PI / branchs.length;
        var phi = (1 + Math.sqrt(5)) / 2;
        var innerRadius = radius / (1 + phi);

        for (var i = 0; i < 2 * branchs.length; i++) {
            var branch = branchs[Math.floor(i / 2)];
            var r = (i & 1) == 0 && branch.isOpen()
                    ? radius
                    : ((i & 1) == 0 ? innerRadius / (phi * .7652) : innerRadius);

            results.push(centerX + Math.cos(i * angle - Math.PI / 2) * r);
            results.push(centerY + Math.sin(i * angle - Math.PI / 2) * r);
        }

        return results;
    }

    function pickSecondBranchIndex(index, length) {
        var next = index + (Math.random() > .5 ? 2 : -2);
        return next < length ? (next < 0 ? next + length : next) : next - length;
    }

    var pickBranch = function (toOpen) {
        var openIndexes = [];
        if (toOpen === 2) {
            var first = _.sample([0, 1, 2, 3, 4]);
            openIndexes.push(first);
            openIndexes.push(pickSecondBranchIndex(first, 5));
        } else {
            openIndexes = _.sample([0, 1, 2, 3, 4], toOpen);
        }
        return openIndexes;
    };

    $(document).ready(function () {
        var WIDTH = 1000;
        var DURATION = 600;
        var branchs = createStar(5);

        var svg = Snap('.blackstar');
        svg.attr({viewBox: [0, 0, WIDTH * 1.2, WIDTH * 1.2].join(' ')});
        var starPolygon = svg.polygon().attr({
            points: calculateStarPoints(WIDTH * .6, WIDTH * .6, branchs, WIDTH / 2),
            fill: 'black'
        });

        setInterval(function () {
            var toOpen = _.sample([2, 2, 3, 3, 3, 5]);
            var openIndexes = pickBranch(toOpen);
            console.log('toOpen: ', toOpen);
            console.log('index to open: ', openIndexes);
            branchs = branchs.map(function (branch) {
                branch.close();
                if (_.includes(openIndexes, branch.index)) {
                    branch.open();
                }
                return branch;
            });

            console.log(branchs.filter(function (branch) {
                return branch.isOpen();
            }).map(function (branch) {
                return branch.index;
            }));

            starPolygon.animate({
                points: calculateStarPoints(WIDTH * .6, WIDTH * .6, branchs, WIDTH / 2)
            }, DURATION, mina.easeout);
        }, DURATION * 3);
    });
</script>
</body>
</html>